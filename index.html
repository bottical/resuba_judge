<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>レスバ判定アプリ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="header-main">
      <h1>レスバ判定レポート</h1>
    </div>
  </header>

  <main class="app-main">
    <!-- 入力エリア -->
    <section class="panel panel-input">
      <details open>
        <summary>入力パネル（タップして開閉）</summary>

        <div class="ai-ingest">
          <div class="form-group">
            <label for="rawTranscript">レスバテキスト（AIに渡す元ログ）</label>
            <textarea
              id="rawTranscript"
              rows="6"
              placeholder="例：\nA：統計的には夜職の子が普通と言われてるんだよ\nB：そのデータは文脈を無視してるだけでしょ？ みたいな生ログを貼り付け"
            ></textarea>
            <small class="hint"
              >ユーザーはここにレスバ全文を貼り付けるだけでOK。以降のIDやスコアはAI側のJSONから反映します。</small
            >
          </div>

          <div class="api-config">
            <div class="form-group">
              <label for="apiEndpoint">AI APIエンドポイント</label>
              <input
                id="apiEndpoint"
                type="url"
                placeholder="https://example.com/api/analyze"
                autocomplete="off"
              />
            </div>
            <div class="form-group">
              <label for="apiKey">APIキー（必要に応じて）</label>
              <input
                id="apiKey"
                type="password"
                placeholder="sk-..."
                autocomplete="off"
              />
              <small class="hint"
                >※APIキーはブラウザのローカルストレージにのみ保存されます。</small
              >
            </div>
          </div>

          <div class="ai-actions">
            <button type="button" id="btnAiApi" class="btn primary">
              レスバテキストを解析（AI API）
            </button>
            <button type="button" id="btnMockAi" class="btn ghost">
              デモ用のモックAIで試す
            </button>
            <p class="hint api-note">
              ※AI APIから取得できるJSONの形式は下の入力欄へそのまま貼り付ける形式と同じです。APIが未設定の場合はモックAIをご利用ください。
            </p>
          </div>

          <div class="form-group">
            <label for="jsonInput">AIからのJSON出力</label>
            <textarea
              id="jsonInput"
              rows="6"
              placeholder='{"meta": {...}, "scores": {...}, "winner": "..."}'
            ></textarea>
            <small class="hint"
              >GPTなどのAIが返すJSONを貼り付けるだけで即時にプレビューへ反映されます。</small
            >
            <p id="jsonStatus" class="json-status" aria-live="polite"></p>
          </div>
        </div>

        <details class="advanced-inputs">
          <summary>詳細編集（必要に応じて）</summary>
          <p class="hint">
            AIの出力を上書きしたい場合は、従来どおり各フィールドを編集して「プレビュー更新」を押してください。
          </p>

          <div class="form-grid">
            <div class="form-group">
              <label for="topic">テーマ / 論点要約</label>
              <textarea id="topic" rows="2" placeholder="例：『普通の女の子』と夜職、水商売23%データの解釈など"></textarea>
            </div>

            <div class="form-row two-cols">
              <div class="form-group">
                <label for="sideAName">側Aの名前 / ID</label>
                <input id="sideAName" type="text" placeholder="例：火気取り (@Virtue_Vulture_)" />
              </div>
              <div class="form-group">
                <label for="sideBName">側Bの名前 / ID</label>
                <input id="sideBName" type="text" placeholder="例：KAZUYA (@kazuyaaaaaaaman)" />
              </div>
            </div>
          </div>

        <!-- スコア入力テーブル -->
        <div class="scores-wrap">
          <h2>7軸のスコア</h2>
          <p class="hint">
            0〜100で入力してください。⑦詭弁ペナルティは値が大きいほど悪い（減点対象）です。
          </p>
          <div class="scores-table">
            <div class="scores-header">
              <div class="cell axis-col">評価軸</div>
              <div class="cell side-col">側A</div>
              <div class="cell side-col">側B</div>
            </div>

            <!-- ① データ妥当性 -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">① データ妥当性</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_validity" min="0" max="100" value="70" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_validity" min="0" max="100" value="50" />
              </div>
            </div>

            <!-- ② 論理一貫性 -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">② 論理一貫性</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_consistency" min="0" max="100" value="65" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_consistency" min="0" max="100" value="55" />
              </div>
            </div>

            <!-- ③ 引用の正確性 -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">③ 引用の正確性</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_interpretation" min="0" max="100" value="80" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_interpretation" min="0" max="100" value="40" />
              </div>
            </div>

            <!-- ④ 再現性・明確性 -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">④ 再現性・明確性</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_clarity" min="0" max="100" value="60" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_clarity" min="0" max="100" value="50" />
              </div>
            </div>

            <!-- ⑤ 説得力 -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">⑤ 説得力</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_persuasiveness" min="0" max="100" value="60" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_persuasiveness" min="0" max="100" value="52" />
              </div>
            </div>

            <!-- ⑥ 対話姿勢 -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">⑥ 対話姿勢</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_stance" min="0" max="100" value="30" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_stance" min="0" max="100" value="34" />
              </div>
            </div>

            <!-- ⑦ 詭弁ペナルティ -->
            <div class="scores-row">
              <div class="cell axis-col">
                <span class="axis-label">⑦ 詭弁ペナルティ</span>
              </div>
              <div class="cell side-col">
                <input type="number" id="A_fallacy" min="0" max="60" value="40" />
              </div>
              <div class="cell side-col">
                <input type="number" id="B_fallacy" min="0" max="60" value="55" />
              </div>
            </div>
          </div>
        </div>

        <!-- 勝敗 & 要約理由 -->
        <div class="form-grid">
          <div class="form-row two-cols">
            <div class="form-group">
              <label for="winner">勝者</label>
              <select id="winner">
                <option value="A">側A</option>
                <option value="B">側B</option>
                <option value="draw">引き分け</option>
              </select>
            </div>
            <div class="form-group">
              <label for="drawThreshold">引き分け判定の閾値（点差）</label>
              <input id="drawThreshold" type="number" min="0" max="50" value="10" />
              <small class="hint">※総合点差がこの値未満なら引き分けと表示</small>
            </div>
          </div>

          <div class="form-group">
            <label for="summaryReasons">判定理由（箇条書き・スクショ用）</label>
            <textarea
              id="summaryReasons"
              rows="3"
              placeholder="例：&#10;- データの読み方と23%の意味について、側Aは正確に説明している一方で、側Bは誤読を継続している&#10;- 詭弁・人格攻撃は双方にあるが、議論を崩す方向への依存度は側Bの方が高い"
            ></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" id="btnUpdate" class="btn primary">
            プレビュー更新
          </button>
          <button type="button" id="btnReset" class="btn ghost">
            入力をリセット
          </button>
        </div>
        </details>
      </details>
    </section>

    <!-- レポートプレビュー（スクショ用） -->
    <section class="panel panel-preview">
      <div class="report-card" id="reportCard">
        <header class="report-header">
          <div>
            <h2 id="reportTitle">レスバ判定レポート（7軸評価）</h2>
            <p class="report-topic" id="reportTopic">
              テーマ：入力パネルからテーマを設定してください。
            </p>
          </div>
          <div class="report-meta">
            <span class="badge" id="reportWinnerBadge">判定：未計算</span>
          </div>
        </header>

        <section class="report-section">
          <h3>1. 論点と当事者</h3>
          <div class="parties">
            <div class="party">
              <div class="party-label">側A</div>
              <div class="party-name" id="reportSideAName">（未設定）</div>
            </div>
            <div class="party">
              <div class="party-label">側B</div>
              <div class="party-name" id="reportSideBName">（未設定）</div>
            </div>
          </div>
        </section>

        <section class="report-section">
          <h3>2. 7軸スコア一覧</h3>
          <div class="scores-summary">
            <div class="total-box">
              <div class="total-label">総合点（側A）</div>
              <div class="total-value" id="reportTotalA">-</div>
            </div>
            <div class="total-box">
              <div class="total-label">総合点（側B）</div>
              <div class="total-value" id="reportTotalB">-</div>
            </div>
          </div>

          <div class="scores-table-view">
            <table>
              <thead>
                <tr>
                  <th>評価軸</th>
                  <th id="thSideA">側A</th>
                  <th id="thSideB">側B</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>① データ妥当性</td>
                  <td id="cell_A_validity">-</td>
                  <td id="cell_B_validity">-</td>
                </tr>
                <tr>
                  <td>② 論理一貫性</td>
                  <td id="cell_A_consistency">-</td>
                  <td id="cell_B_consistency">-</td>
                </tr>
                <tr>
                  <td>③ 引用の正確性</td>
                  <td id="cell_A_interpretation">-</td>
                  <td id="cell_B_interpretation">-</td>
                </tr>
                <tr>
                  <td>④ 再現性・明確性</td>
                  <td id="cell_A_clarity">-</td>
                  <td id="cell_B_clarity">-</td>
                </tr>
                <tr>
                  <td>⑤ 説得力</td>
                  <td id="cell_A_persuasiveness">-</td>
                  <td id="cell_B_persuasiveness">-</td>
                </tr>
                <tr>
                  <td>⑥ 対話姿勢</td>
                  <td id="cell_A_stance">-</td>
                  <td id="cell_B_stance">-</td>
                </tr>
                <tr>
                  <td>⑦ 詭弁ペナルティ（低いほど良）</td>
                  <td id="cell_A_fallacy">-</td>
                  <td id="cell_B_fallacy">-</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="chart-wrap">
            <canvas id="radarChart"></canvas>
          </div>
        </section>

        <section class="report-section">
          <h3>3. 判定と理由（要約）</h3>
          <p class="verdict-text" id="reportVerdictText">
            まだ判定が計算されていません。「プレビュー更新」を押してください。
          </p>
          <ul class="reasons-list" id="reportReasonsList">
            <!-- 判定理由の箇条書き -->
          </ul>
        </section>

        <footer class="report-footer">
          <p class="note">
            ※このレポートは議論内容の論理構造に基づく技術的評価であり、当事者個人の人格や価値を評価するものではありません。
          </p>
        </footer>
      </div>
    </section>
  </main>

  <script src="assets/app.js"></script>
</body>
</html>
